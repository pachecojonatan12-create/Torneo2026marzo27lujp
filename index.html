<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo de Gallos - Acceso Directo</title>
    <style>
        :root { --primary: #d32f2f; --dark: #1a1a1a; --light: #f4f4f4; --success: #2e7d32; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        @media screen {
            h1, h2 { color: var(--dark); text-align: center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
            .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
            .input-group { display: flex; flex-direction: column; }
            label { font-weight: bold; font-size: 0.85em; margin-bottom: 5px; color: #555; }
            input { padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1em; }
            .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
            button { flex: 1; min-width: 120px; padding: 12px; border-radius: 6px; border: none; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
            .btn-add { background: var(--primary); }
            .btn-match { background: var(--success); }
            .btn-print { background: #0277bd; }
            .btn-clear { background: #555; }
            button:hover { opacity: 0.8; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
            th { background: #eee; }
            .match-card { background: #e8f5e9; border-left: 5px solid var(--success); margin: 10px 0; padding: 15px; border-radius: 5px; }
            .match-info { display: flex; justify-content: space-between; align-items: center; }
            .vs { font-weight: bold; color: var(--primary); font-size: 1.2em; }
        }

        @media print {
            .btn-group, .form-grid, h2, .btn-delete, #seccion-registro, .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; border: none; }
            .print-only { display: block !important; }
            .match-card { border: 1px solid #000; background: white !important; page-break-inside: avoid; margin-bottom: 10px; }
            .vs { color: black !important; }
        }
        .print-only { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="print-only" style="text-align: center;">
        <h1>ACTA OFICIAL DE ENFRENTAMIENTOS</h1>
        <p>Fecha: <span id="print-date"></span></p>
        <hr>
    </div>

    <h1>Gesti√≥n de Torneo</h1>
    
    <div id="seccion-registro">
        <div class="form-grid">
            <div class="input-group"><label>Cuerda</label><input type="text" id="cuerda" placeholder="Nombre"></div>
            <div class="input-group"><label>Placa</label><input type="text" id="placa" placeholder="A-01"></div>
            <div class="input-group"><label>Libras</label><input type="number" id="lbs" placeholder="3"></div>
            <div class="input-group"><label>Onzas</label><input type="number" id="oz" placeholder="2"></div>
            <div class="input-group"><label>Marca (Meses)</label><input type="number" id="marca" placeholder="18"></div>
        </div>

        <div class="btn-group">
            <button class="btn-add" onclick="agregarGallo()">Registrar</button>
            <button class="btn-match" onclick="generarCotejos()">Cotejar</button>
            <button class="btn-print" onclick="imprimirCotejos()">üñ®Ô∏è Imprimir Acta</button>
            <button class="btn-clear" onclick="limpiarTodo()">Borrar Todo</button>
        </div>

        <table>
            <thead><tr><th>Cuerda</th><th>Placa</th><th>Peso</th><th>Edad</th><th>X</th></tr></thead>
            <tbody id="cuerpo-tabla"></tbody>
        </table>
    </div>

    <div id="seccion-cotejos">
        <h2 class="no-print">Enfrentamientos Pactados</h2>
        <div id="lista-cotejos"></div>
    </div>
    
    <div class="print-only" style="margin-top: 50px; display: flex; justify-content: space-around;">
        <div style="border-top: 1px solid black; width: 200px; text-align: center;">Firma Organizador</div>
        <div style="border-top: 1px solid black; width: 200px; text-align: center;">Firma Juez</div>
    </div>
</div>

<script>
    let gallos = JSON.parse(localStorage.getItem('gallos_v5')) || [];

    window.onload = actualizarInterfaz;

    function agregarGallo() {
        const cuerda = document.getElementById('cuerda').value;
        const placa = document.getElementById('placa').value;
        const lbs = parseInt(document.getElementById('lbs').value) || 0;
        const oz = parseInt(document.getElementById('oz').value) || 0;
        const marca = parseInt(document.getElementById('marca').value) || 0;

        if(!cuerda || !placa) return alert("Faltan datos");

        gallos.push({
            id: Date.now(),
            cuerda: cuerda.toUpperCase(),
            placa: placa.toUpperCase(),
            lbs, oz, marca,
            totalOnzas: (lbs * 16) + oz
        });

        localStorage.setItem('gallos_v5', JSON.stringify(gallos));
        actualizarInterfaz();
        
        // Limpiar solo placa, peso y marca para agilizar el registro de la misma cuerda
        document.getElementById('placa').value = "";
        document.getElementById('lbs').value = "";
        document.getElementById('oz').value = "";
    }

    function actualizarInterfaz() {
        const tbody = document.getElementById('cuerpo-tabla');
        tbody.innerHTML = "";
        gallos.forEach(g => {
            tbody.innerHTML += `<tr>
                <td>${g.cuerda}</td>
                <td>${g.placa}</td>
                <td>${g.lbs}.${g.oz}</td>
                <td>${g.marca}m</td>
                <td><button onclick="eliminar(${g.id})" class="btn-delete" style="background:#555; padding:2px 8px; min-width:auto;">X</button></td>
            </tr>`;
        });
    }

    function generarCotejos() {
        const contenedor = document.getElementById('lista-cotejos');
        contenedor.innerHTML = "";
        let emparejados = new Set();
        let lista = [...gallos].sort((a, b) => a.totalOnzas - b.totalOnzas);
        let numPelea = 1;

        for (let i = 0; i < lista.length; i++) {
            if (emparejados.has(lista[i].id)) continue;
            for (let j = i + 1; j < lista.length; j++) {
                if (emparejados.has(lista[j].id)) continue;

                const diffPeso = Math.abs(lista[i].totalOnzas - lista[j].totalOnzas);
                const diffMarca = Math.abs(lista[i].marca - lista[j].marca);

                // REGLAS: Diferencia Peso <= 2 oz | Diferencia Marca <= 5 meses | Diferente Cuerda
                if (diffPeso <= 2 && diffMarca <= 5 && lista[i].cuerda !== lista[j].cuerda) {
                    emparejados.add(lista[i].id);
                    emparejados.add(lista[j].id);

                    contenedor.innerHTML += `
                        <div class="match-card">
                            <div style="text-align:center; font-weight:bold; border-bottom:1px solid #ddd; margin-bottom:10px;">PELEA N¬∞ ${numPelea++}</div>
                            <div class="match-info">
                                <div><strong>${lista[i].cuerda}</strong><br>Placa: ${lista[i].placa}<br>Peso: ${lista[i].lbs}.${lista[i].oz}</div>
                                <div class="vs"> VS </div>
                                <div style="text-align:right"><strong>${lista[j].cuerda}</strong><br>Placa: ${lista[j].placa}<br>Peso: ${lista[j].lbs}.${lista[j].oz}</div>
                            </div>
                            <div style="font-size:0.8em; text-align:center; margin-top:5px;">Diferencia: ${diffPeso} oz | Margen Marca: ${diffMarca} meses</div>
                        </div>`;
                    break;
                }
            }
        }
        if(emparejados.size === 0) contenedor.innerHTML = "<p style='text-align:center'>No se hallaron parejas con los criterios actuales.</p>";
    }

    function imprimirCotejos() {
        if (document.getElementById('lista-cotejos').innerHTML === "" || document.getElementById('lista-cotejos').innerText.includes("No se hallaron")) {
            alert("Primero genera los cotejos antes de imprimir.");
            return;
        }
        document.getElementById('print-date').innerText = new Date().toLocaleDateString();
        window.print();
    }

    function eliminar(id) {
        gallos = gallos.filter(g => g.id !== id);
        localStorage.setItem('gallos_v5', JSON.stringify(gallos));
        actualizarInterfaz();
    }

    function limpiarTodo() {
        if(confirm("¬øEst√°s seguro de borrar todos los datos del evento?")) {
            gallos = [];
            localStorage.removeItem('gallos_v5');
            location.reload();
        }
    }
</script>
</body>
</html>
